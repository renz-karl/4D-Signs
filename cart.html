<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - 4D signs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
    <style>
        .edit-custom-btn {
            background: linear-gradient(135deg, #FFD700, #FFC700);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
            margin-left: 8px;
            transition: background-color 0.3s ease;
        }
        
        .edit-custom-btn:hover {
            background: #cbae2e;
        }
        
        .edit-custom-btn i {
            font-size: 1rem;
        }
        
        .custom-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #FFD700, #FFC700);
            color: #1a1a2e;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 4px;
        }
        
        .custom-badge i {
            font-size: 0.7rem;
        }
        
        .item-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #FFD700;
            margin-right: 1rem;
        }
        
        .select-all-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem 1.5rem;
            background: rgba(40, 38, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .select-all-container label {
            cursor: pointer;
            font-weight: 500;
            color: #FFD700;
            user-select: none;
        }
        
        .select-all-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #FFD700;
        }
        
        .selection-info {
            margin-left: auto;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(rgba(40, 38, 58, 0.95), rgba(40, 38, 58, 0.95)), url('afce65d8-7606-4689-8ab3-9e76f7c22551.png') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
        }

        .main-header {
            background-color: rgba(40, 38, 58, 0.98);
            backdrop-filter: blur(10px);
            padding: 0.75rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            color: #FFD700;
            text-decoration: none;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
            white-space: nowrap;
        }

        .nav-bar {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            justify-content: flex-end;
            flex: 1;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
            color: #FFD700;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .nav-link.active {
            background: #FFD700;
            color: #28263A;
            border-color: #FFD700;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .header h1 {
            color: #ffd700;
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 215, 0, 0.2);
            background: rgba(255, 215, 0, 0.1);
        }

        .back-btn i {
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border-color: rgba(255, 215, 0, 0.4);
        }

        .back-btn:hover i {
            transform: translateX(-4px);
        }

        .cart-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .cart-empty {
            text-align: center;
            padding: 3rem;
            background: rgba(40, 38, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .cart-empty i {
            color: #ffd700;
            margin-bottom: 1.5rem;
        }

        .cart-empty h2 {
            color: #ffd700;
            margin-bottom: 1rem;
        }

        .cart-empty p {
            color: rgba(255, 255, 255, 0.8);
        }

        .cart-items-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .cart-item {
            display: grid;
            grid-template-columns: auto auto 1fr auto;
            gap: 1.5rem;
            align-items: center;
            padding: 1.5rem;
            background: rgba(40, 38, 58, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .cart-item.selected {
            border-color: rgba(255, 215, 0, 0.6);
            background: rgba(40, 38, 58, 0.95);
        }

        .cart-item:hover {
            transform: translateY(-2px);
            background: rgba(40, 38, 58, 0.9);
            border-color: rgba(255, 215, 0, 0.4);
        }

        .item-thumb {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .item-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item-name {
            font-weight: 600;
            font-size: 1.2rem;
            color: #ffd700;
        }

        .item-category {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .qty-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .qty-input {
            width: 60px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 8px;
            padding: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
        }

        .qty-input:focus {
            outline: none;
            border-color: #ffd700;
        }

        .delete-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(255, 99, 99, 0.3);
            background: rgba(255, 99, 99, 0.1);
            color: #ff6b6b;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: rgba(255, 99, 99, 0.2);
            border-color: #ff6b6b;
        }

        .cart-summary {
            background: rgba(40, 38, 58, 0.8);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .cart-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .cart-action {
            padding: 1rem 2rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .cart-action.primary {
            background: #ffd700;
            color: #28263A;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .cart-action.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .cart-action:not(.primary) {
            background: rgba(40, 38, 58, 0.6);
            color: #fff;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .cart-action:not(.primary):hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 0.5rem 0;
            }

            .header-content {
                padding: 0 1rem;
                gap: 1rem;
            }

            .logo {
                font-size: 1.5rem;
            }

            .nav-bar {
                gap: 0.4rem;
                overflow-x: auto;
                justify-content: flex-start;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .nav-bar::-webkit-scrollbar {
                display: none;
            }

            .nav-link {
                padding: 0.6rem 0.75rem;
                font-size: 0.85rem;
            }

            .nav-link span:not(.cart-badge) {
                display: none;
            }

            .nav-link i {
                font-size: 1.15rem;
            }

            .cart-item {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .item-thumb {
                margin: 0 auto;
            }

            .item-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 0 0.75rem;
                gap: 0.75rem;
            }

            .logo {
                font-size: 1.3rem;
            }

            .nav-link {
                padding: 0.5rem 0.6rem;
            }

            .nav-link i {
                font-size: 1.1rem;
            }
        }

        @media (min-width: 1200px) {
            .header-content {
                max-width: 1600px;
            }

            .nav-bar {
                gap: 0.75rem;
            }

            .nav-link {
                padding: 0.75rem 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <a href="/4D-Signs/4Dsigns.php" class="logo">4D Signs</a>
            <nav class="nav-bar">
                <a href="/4D-Signs/4Dsigns.php" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/4D-Signs/customize.html" class="nav-link"><i class="fas fa-palette"></i> Customize</a>
                <a href="/4D-Signs/review.html" class="nav-link"><i class="fas fa-star"></i> <span>Orders/Reviews</span></a>
                <a href="/4D-Signs/cart.html" class="nav-link active" title="Cart"><i class="fas fa-shopping-cart"></i></a>
                <a href="/4D-Signs/contact.html" class="nav-link" title="Contact"><i class="fas fa-envelope"></i></a>
            </nav>
        </div>
    </header>

    <main class="cart-container">
        <div id="page-cart-empty" class="cart-empty">
            <i class="fas fa-shopping-bag fa-3x"></i>
            <h2>Your Shopping Cart is Empty</h2>
            <p>Discover our amazing custom products and add some to your cart!</p>
            <a href="/4D-Signs/4Dsigns.php" class="cart-action primary" style="display: inline-block; margin-top: 2rem;">
                <i class="fas fa-store"></i>
                Browse Products
            </a>
        </div>

        <div id="select-all-container" class="select-all-container" style="display: none;">
            <input type="checkbox" id="select-all-checkbox" class="select-all-checkbox">
            <label for="select-all-checkbox">Select All</label>
            <span id="selection-info" class="selection-info">0 items selected</span>
        </div>

        <ul id="page-cart-items" class="cart-items-list"></ul>

        <div id="page-cart-summary" class="cart-summary" style="display:none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <span>Items in Cart:</span>
                <span id="page-cart-count" style="color: #ffd700; font-size: 1.2rem; font-weight: 600;">0</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                <span>Cart Total:</span>
                <span id="cart-total-price" style="color: #ffd700; font-size: 1.3rem; font-weight: 700;">₱0.00</span>
            </div>
            <div id="selected-total-section" style="display: none; padding-top: 1rem; border-top: 2px solid rgba(255, 215, 0, 0.4);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                    <span style="font-size: 1.1rem; font-weight: 600;">Selected Total:</span>
                    <span id="selected-total-price" style="color: #FFD700; font-size: 1.5rem; font-weight: 700;">₱0.00</span>
                </div>
            </div>
        </div>

        <div class="cart-actions">
            <a href="/4D-Signs/4Dsigns.php" class="cart-action">
                <i class="fas fa-arrow-left"></i>
                Continue Shopping
            </a>
            <button id="page-remove-selected" class="cart-action" style="display: none;">
                <i class="fas fa-trash-alt"></i>
                Remove Selected
            </button>
            <button id="page-checkout" class="cart-action primary">
                <i class="fas fa-check"></i>
                Checkout Selected
            </button>
        </div>
    </main>



  <script src="cart-utils.js"></script>
  <script>
  (function(){
    const badgeEl = document.getElementById('cart-count');

    function getItems() { return (window.cartStorage && typeof window.cartStorage.getItems === 'function') ? window.cartStorage.getItems() : []; }
    function renderBadge(n){ if (badgeEl) badgeEl.textContent = n; }
    function setItems(items) { if (window.cartStorage && typeof window.cartStorage.setItems === 'function') { window.cartStorage.setItems(items); } else { try { localStorage.setItem('cartItems', JSON.stringify(items)); } catch(e) {} } }
        // addItem now accepts optional color, size and price and stores them on the item
        function addItem(name, qty = 1, color = null, size = null, price = null) {
            if (!name) name = 'Item';
            qty = Math.max(1, parseInt(qty,10) || 1);
            const id = name.trim().toLowerCase();
            const items = getItems();
            // match same id and same options (color/size) to group items
            const idx = items.findIndex(i => i.id === id && (i.color || null) === (color || null) && (i.size || null) === (size || null));
            if (idx >= 0) {
                items[idx].qty += qty;
                if (price != null) items[idx].price = Number(price);
            } else {
                const item = { id, name, qty };
                if (color) item.color = color;
                if (size) item.size = size;
                if (price != null) item.price = Number(price);
                items.push(item);
            }
            setItems(items);
        }
    function updateQty(id, qty) {
      const items = getItems();
      const idx = items.findIndex(i => i.id === id);
      if (idx === -1) return;
      qty = parseInt(qty,10) || 0;
      if (qty <= 0) items.splice(idx,1); else items[idx].qty = qty;
      setItems(items);
    }
    function removeItem(id) {
      const items = getItems().filter(i => i.id !== id);
      setItems(items);
    }

  
    window.getCartItems = getItems;
    window.setCartItems = setItems;
    window.addItemToCart = addItem;
    window.updateCartItemQty = updateQty;
    window.removeCartItem = removeItem;

  renderBadge((window.cartStorage && typeof window.cartStorage.getCount === 'function') ? window.cartStorage.getCount() : parseInt(localStorage.getItem('cartCount') || '0', 10));
  })();

  // Function to handle editing custom items
  function editCustomItem(itemId) {
    // Store current item details before editing
  const cartItems = getItems();
    const itemToEdit = cartItems.find(item => item.id === itemId);
    
    if (itemToEdit) {
      console.log('Editing item:', itemToEdit);
      
      // Store the complete item data for editing
      localStorage.setItem('editingCustomItem', JSON.stringify({
        item: itemToEdit,
        id: itemId,
        index: cartItems.indexOf(itemToEdit)
      }));
      
      console.log('Stored editing data for item ID:', itemId);
      
    // Redirect to customize page for editing
  window.location.href = 'customize.html?mode=edit&id=' + encodeURIComponent(itemId);
    } else {
      console.error('Item not found:', itemId);
    }
  }
  </script>

  <script>
  (function(){
    const list = document.getElementById('page-cart-items');
    const empty = document.getElementById('page-cart-empty');
    const summary = document.getElementById('page-cart-summary');
    const countEl = document.getElementById('page-cart-count');
    const clearBtn = document.getElementById('page-clear-cart');
    const checkoutBtn = document.getElementById('page-checkout');
    const editAllBtn = document.getElementById('page-edit-toggle');

    let editingAll = false;
    function resolveImage(key){
      key = (key || '').toLowerCase();
      const map = {
        'souvenirs':'images/souvenir1.jpg',
        'giveaways':'images/giveaway1.jpg',
        'bulk packages':'images/bulk1.jpg',
        'custom signage':'images/signage1.jpg',
        'banners':'images/banner1.jpg',
        'stickers & decals':'images/sticker1.jpg',
        'custom mugs':'images/mug1.jpg',
        't-shirt printing':'images/tshirt1.jpg',
        'keychains':'images/keychain1.jpg',
        'invitations':'images/invitation1.jpg',
        'calling cards':'images/callingcard1.jpg'
      };
      return map[key] || 'BGDS.jpg';
    }

    function items() { return (typeof getCartItems === 'function') ? getCartItems() : []; }

    function render(){
      const its = items();
      console.log('Rendering cart with items:', its);
      const count = its.reduce((s,i)=> s + (parseInt(i.qty,10) || 0), 0);
      if (countEl) countEl.textContent = count;
      
      const selectAllContainer = document.getElementById('select-all-container');
      
      if (!its.length) {
        if (empty) empty.style.display = 'block';
        if (summary) summary.style.display = 'none';
        if (list) list.innerHTML = '';
        if (selectAllContainer) selectAllContainer.style.display = 'none';
        return;
      }
      if (empty) empty.style.display = 'none';
      if (summary) summary.style.display = 'block';
      if (selectAllContainer) selectAllContainer.style.display = 'flex';
      
      if (list) {
        list.innerHTML = its.map(it => {
          console.log('Rendering item:', it);
          const editing = editingAll ? ' editing' : '';
          // Use custom image if available, otherwise fallback to resolved image
          // Check for designData (new structure) or legacy design/customImage
          const img = it.designData?.images?.[0]?.src || it.design?.image || it.customImage || it.image || resolveImage(it.id || it.name);
          console.log('Image for item:', img);
          const itemPrice = parseFloat(it.price) || 25.00;
          const itemTotal = itemPrice * (parseInt(it.qty) || 1);
          return `
          <li class="cart-item" data-id="${it.id}" data-price="${itemPrice}" data-qty="${it.qty}">
            <input type="checkbox" class="item-checkbox" data-item-id="${it.id}">
            <img class="item-thumb" src="${img}" alt="${it.name}">
            <div class="item-details">
                <div class="item-name">${it.name || (it.designData && it.designData.name) || 'Custom Design'}</div>
                <div class="item-category">${it.productType || it.category || 'Custom'}</div>
                ${it.size ? `<div style="display: inline-flex; align-items: center; gap: 8px; margin-top: 4px;">
                    <span style="padding: 3px 10px; background: rgba(255, 215, 0, 0.2); border: 1px solid rgba(255, 215, 0, 0.4); border-radius: 6px; color: #FFD700; font-size: 0.75rem; font-weight: 700;">SIZE: ${it.size.toUpperCase()}</span>
                    ${it.color ? `<span style="display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; font-size: 0.75rem;">
                        <span style="width: 14px; height: 14px; border-radius: 50%; background: ${it.color}; border: 1px solid rgba(255, 255, 255, 0.3);"></span>
                        <span style="color: rgba(255, 255, 255, 0.9); font-weight: 600;">${it.color.toUpperCase()}</span>
                    </span>` : ''}
                </div>` : ''}
                ${it.isCustom ? '<span class="custom-badge"><i class="fas fa-magic"></i> Customized</span>' : ''}
                <div style="margin-top: 0.5rem; color: #FFD700; font-weight: 600;">
                    ₱${itemPrice.toFixed(2)} × ${it.qty} = ₱${itemTotal.toFixed(2)}
                </div>
            </div>
            <div class="item-controls">
                <button class="qty-btn minus" aria-label="Decrease quantity">
                    <i class="fas fa-minus"></i>
                </button>
                <input class="qty-input" type="number" min="1" value="${it.qty}" aria-label="Item quantity">
                <button class="qty-btn plus" aria-label="Increase quantity">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="delete-btn" aria-label="Remove item">
                    <i class="fas fa-trash-alt"></i>
                </button>
                ${it.isCustom ? `
                <button class="edit-custom-btn" aria-label="Edit customization" onclick="editCustomItem('${it.id}')">
                    <i class="fas fa-edit"></i>
                </button>` : ''}
            </div>
          </li>`;
        }).join('');
        
        // Update selection count
        updateSelectionInfo();
      }
    }

    if (list) {
      list.addEventListener('click', function(e){
        const target = e.target;
        const itemEl = target.closest('.cart-item');
        if (!itemEl) return;
        const id = itemEl.getAttribute('data-id');
        
        // Handle checkbox clicks
        if (target.classList.contains('item-checkbox')) {
          updateSelectionInfo();
          // Toggle selected class
          if (target.checked) {
            itemEl.classList.add('selected');
          } else {
            itemEl.classList.remove('selected');
          }
          return;
        }
        
        if (target.classList.contains('delete-btn')) {
          if (typeof removeCartItem === 'function') removeCartItem(id);
          render();
        } else if (target.classList.contains('qty-btn')) {
          const input = itemEl.querySelector('.qty-input');
          let qty = parseInt(input.value,10) || 1;
          if (target.classList.contains('minus')) qty = Math.max(1, qty - 1);
          if (target.classList.contains('plus')) qty = qty + 1;
          input.value = qty;
          if (typeof updateCartItemQty === 'function') updateCartItemQty(id, qty);
          render();
        }
      });
      list.addEventListener('change', function(e){
        const input = e.target.closest('.qty-input');
        if (!input) return;
        const itemEl = e.target.closest('.cart-item');
        const id = itemEl.getAttribute('data-id');
        let qty = Math.max(1, parseInt(input.value,10) || 1);
        input.value = qty;
        if (typeof updateCartItemQty === 'function') updateCartItemQty(id, qty);
        render();
      });
    }
    
    // Selection functionality
    function updateSelectionInfo() {
      const checkboxes = document.querySelectorAll('.item-checkbox');
      const checkedCheckboxes = document.querySelectorAll('.item-checkbox:checked');
      const checkedCount = checkedCheckboxes.length;
      const selectionInfo = document.getElementById('selection-info');
      const removeSelectedBtn = document.getElementById('page-remove-selected');
      const selectAllCheckbox = document.getElementById('select-all-checkbox');
      const selectedTotalSection = document.getElementById('selected-total-section');
      const selectedTotalPrice = document.getElementById('selected-total-price');
      
      if (selectionInfo) {
        selectionInfo.textContent = `${checkedCount} item${checkedCount !== 1 ? 's' : ''} selected`;
      }
      
      // Calculate selected total
      let selectedTotal = 0;
      checkedCheckboxes.forEach(checkbox => {
        const itemEl = checkbox.closest('.cart-item');
        const price = parseFloat(itemEl.getAttribute('data-price')) || 0;
        const qty = parseInt(itemEl.getAttribute('data-qty')) || 1;
        selectedTotal += price * qty;
      });
      
      // Show/hide selected total section
      if (selectedTotalSection) {
        if (checkedCount > 0) {
          selectedTotalSection.style.display = 'block';
          if (selectedTotalPrice) {
            selectedTotalPrice.textContent = `₱${selectedTotal.toFixed(2)}`;
          }
        } else {
          selectedTotalSection.style.display = 'none';
        }
      }
      
      // Show/hide remove selected button
      if (removeSelectedBtn) {
        removeSelectedBtn.style.display = checkedCount > 0 ? 'block' : 'none';
      }
      
      // Update select all checkbox state
      if (selectAllCheckbox) {
        selectAllCheckbox.checked = checkboxes.length > 0 && checkedCount === checkboxes.length;
        selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
      }
      
      // Calculate and display cart total
      updateCartTotal();
    }
    
    // Calculate cart total
    function updateCartTotal() {
      const cartItems = document.querySelectorAll('.cart-item');
      let cartTotal = 0;
      
      cartItems.forEach(itemEl => {
        const price = parseFloat(itemEl.getAttribute('data-price')) || 0;
        const qty = parseInt(itemEl.getAttribute('data-qty')) || 1;
        cartTotal += price * qty;
      });
      
      const cartTotalPrice = document.getElementById('cart-total-price');
      if (cartTotalPrice) {
        cartTotalPrice.textContent = `₱${cartTotal.toFixed(2)}`;
      }
    }
    
    // Select All functionality
    const selectAllCheckbox = document.getElementById('select-all-checkbox');
    if (selectAllCheckbox) {
      selectAllCheckbox.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.item-checkbox');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
          const itemEl = checkbox.closest('.cart-item');
          if (this.checked) {
            itemEl.classList.add('selected');
          } else {
            itemEl.classList.remove('selected');
          }
        });
        updateSelectionInfo();
      });
    }
    
    // Remove Selected functionality
    const removeSelectedBtn = document.getElementById('page-remove-selected');
    if (removeSelectedBtn) {
      removeSelectedBtn.addEventListener('click', function() {
        const checkedCheckboxes = document.querySelectorAll('.item-checkbox:checked');
        const selectedIds = Array.from(checkedCheckboxes).map(cb => cb.getAttribute('data-item-id'));
        
        if (selectedIds.length === 0) {
          alert('Please select items to remove');
          return;
        }
        
        if (confirm(`Are you sure you want to remove ${selectedIds.length} item(s) from your cart?`)) {
          const cartItems = items();
          const updatedItems = cartItems.filter(item => !selectedIds.includes(String(item.id)));
          
          if (typeof setCartItems === 'function') {
            setCartItems(updatedItems);
          }
          render();
        }
      });
    }

    if (editAllBtn) editAllBtn.addEventListener('click', function(){
      editingAll = !editingAll;
      editAllBtn.setAttribute('aria-pressed', editingAll ? 'true' : 'false');
      render();
    });

    if (clearBtn) clearBtn.addEventListener('click', function(){
      if (typeof setCartItems === 'function') setCartItems([]);
      render();
    });

    if (checkoutBtn) checkoutBtn.addEventListener('click', function(){
      const checkedCheckboxes = document.querySelectorAll('.item-checkbox:checked');
      
      if (checkedCheckboxes.length === 0) {
        alert('Please select at least one item to checkout');
        return;
      }
      
      const selectedIds = Array.from(checkedCheckboxes).map(cb => cb.getAttribute('data-item-id'));
      const cartItems = items();
      const selectedItems = cartItems.filter(item => selectedIds.includes(String(item.id)));
      
      // Store selected items for checkout
      localStorage.setItem('checkoutItems', JSON.stringify(selectedItems));
      
  window.location.href = 'checkout.html';
    });

    window.addEventListener('cart:updated', render);
    render();
  })();
  </script>
</body>
</html>
