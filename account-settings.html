<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings - 4D Signs</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="left-section">
                <div class="profile-dropdown">
                    <button class="profile-btn" id="profile-btn"><img src="https://via.placeholder.com/32x32/FFD700/28263A?text=U" alt="Profile" class="profile-img"></button>
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="contact.html"><i class="fas fa-envelope"></i>Contact</a>
                <a href="account-settings.html"><i class="fas fa-cog"></i>Settings</a>
                <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i>Logout</a>
                    </div>
                </div>
                <a href="/4D-Signs/4Dsigns.php" class="logo">4D Signs</a>
            </div>
            <nav class="nav-bar">
                <a href="/4D-Signs/4Dsigns.php" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/4D-Signs/customize.html" class="nav-link"><i class="fas fa-palette"></i> Customize</a>
                <a href="/4D-Signs/review.html" class="nav-link"><i class="fas fa-star"></i> <span>Orders/Reviews</span></a>
                <a href="/4D-Signs/cart.html" class="nav-link" title="Cart"><i class="fas fa-shopping-cart"></i></a>
                <a href="/4D-Signs/contact.html" class="nav-link" title="Contact"><i class="fas fa-envelope"></i></a>
            </nav>
        </div>
    </header>

    <main>
        <section class="account-settings-section">
            <div class="container">
                <div class="settings-header">
                    <h1><i class="fas fa-user-cog"></i> Account Settings</h1>
                    <p>Manage your account information and preferences</p>
                </div>

                    <div class="settings-content">
                        <style>
                            .account-avatar { display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:20px; }
                            .account-avatar .avatar-wrap { width:220px; height:220px; border-radius:50%; overflow:hidden; display:inline-block; border:3px solid #f0f0f0; position:relative; cursor:pointer; }
                            .account-avatar img.avatar-img { width:100%; height:100%; object-fit:cover; object-position:center center; display:block; border:0; }
                            .avatar-edit { position:absolute; right:10px; bottom:10px; background:rgba(0,0,0,0.6); color:#fff; width:34px; height:34px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:14px; cursor:pointer; }
                            .avatar-info { text-align:center; }
                            /* avatar username removed from UI */
                            /* avatar email removed per design */
                            .profile-pic-input { display:none; }
                        </style>
                        <div class="account-avatar">
                            <div class="avatar-wrap" id="avatar-wrap" title="Change profile picture">
                                <img src="https://via.placeholder.com/96x96/FFD700/28263A?text=U" alt="Profile" class="avatar-img profile-img">
                                <div class="avatar-edit" id="avatar-edit">Change</div>
                            </div>
                            <div class="avatar-info"></div>
                        </div>
                    <div class="settings-card">
                        <div class="card-header">
                            <h2><i class="fas fa-user"></i> Account Information</h2>
                        </div>
                        <div class="card-body">
                            <div class="account-info">
                                <div class="info-item">
                                    <label>Username:</label>
                                    <span id="current-username">johndoe</span>
                                </div>
                                <div class="info-item">
                                    <label>Email:</label>
                                    <span id="current-email">john.doe@example.com</span>
                                </div>
                                <div class="info-item">
                                    <label>Phone:</label>
                                    <span id="current-phone">N/A</span>
                                </div>
                                <div class="info-item">
                                    <label>Member Since:</label>
                                    <span id="member-since">January 2024</span>
                                </div>
                                <div class="info-item">
                                    <label>Account Status:</label>
                                    <span class="status-active">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="card-header">
                            <h2><i class="fas fa-edit"></i> Update Account Details</h2>
                        </div>
                        <div class="card-body">
                            <form id="account-form" class="settings-form">
                                <div class="form-group">
                                    <label for="new-username">New Username:</label>
                                    <input type="text" id="new-username" name="username" placeholder="Enter new username">
                                    <small>Leave blank to keep current username</small>
                                </div>

                                <div class="form-group">
                                    <label for="current-password">Current Password:</label>
                                    <input type="password" id="current-password" name="current_password" placeholder="Enter current password" required>
                                </div>

                                <div class="form-group">
                                    <label for="new-password">New Password:</label>
                                    <input type="password" id="new-password" name="new_password" placeholder="Enter new password">
                                    <small>Leave blank to keep current password</small>
                                </div>

                                <div class="form-group">
                                    <label for="confirm-password">Confirm New Password:</label>
                                    <input type="password" id="confirm-password" name="confirm_password" placeholder="Confirm new password">
                                </div>

                                <div class="form-group">
                                    <label for="new-phone">Phone Number:</label>
                                    <input type="text" id="new-phone" name="phone" placeholder="09XXXXXXXXX or +63XXXXXXXXX">
                                    <small>Enter Philippine number; will be normalized to +63XXXXXXXXX</small>
                                </div>

                                <!-- Profile picture editing moved above the account info (avatar). -->

                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">Update Account</button>
                                    <button type="button" class="btn-secondary" onclick="resetForm()">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="settings-card danger-zone">
                        <div class="card-header">
                            <h2><i class="fas fa-exclamation-triangle"></i> Danger Zone</h2>
                        </div>
                        <div class="card-body">
                            <p>Once you delete your account, there is no going back. Please be certain.</p>
                            <button class="btn-danger" onclick="confirmDeleteAccount()">
                                <i class="fas fa-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="footer-wrap">
            <div class="footer-col brand">
                <h3>4D signs</h3>
                <p>Your vision, our signs. Premium custom signage and souvenirs.</p>
                <div class="footer-social">
                    <a href="https://www.facebook.com/FourDsigns" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <nav class="footer-col links" aria-label="Footer navigation">
                <h4>Explore</h4>
                <ul>
                    <li><a href="/4D-Signs/4Dsigns.php">Home</a></li>
                        <li><a href="customize.html">Customize</a></li>
                        <li><a href="review.html"><span>Orders/Reviews</span></a></li>
                        <li><a href="cart.html">Cart</a></li>
                </ul>
            </nav>
            <div class="footer-col contact">
                <h4>Contact</h4>
                <ul>
                    <li><i class="fa fa-map-marker-alt"></i> 352 Zone 4 Tangos, Baliuag, Philippines, 3006</li>
                    <li><i class="fa fa-envelope"></i>cheriz20domingo@gmail.com</li>
                    <li><i class="fa fa-phone"></i> +63 917 582 5483</li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© <span id="footer-year"></span> 4D signs · All rights reserved</p>
        </div>
    </footer>

    <script>
// Profile dropdown functionality
document.getElementById('profile-btn').addEventListener('click', function(e) {
    e.stopPropagation();
    const menu = document.getElementById('dropdown-menu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
});

window.addEventListener('click', function(e) {
    if (!e.target.closest('.profile-dropdown')) {
        document.getElementById('dropdown-menu').style.display = 'none';
    }
});

function logout() {
    try { localStorage.removeItem('loggedInUser'); } catch(e) {}
    // Ensure the server-side session is cleared as well
    window.location.href = 'logout.php';
}

// Account settings functionality
document.getElementById('account-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || 'null');
    if (!loggedInUser && window.serverAuth && window.serverUser) {
        loggedInUser = window.serverUser;
    }
    if (!loggedInUser) {
        alert('Please login first.');
        window.location.href = 'login.html';
        return;
    }
    const newUsername = document.getElementById('new-username').value.trim();
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const newPhone = (document.getElementById('new-phone') ? document.getElementById('new-phone').value.trim() : '');
    // Basic validation
    if (newPassword && newPassword !== confirmPassword) { alert('New passwords do not match.'); return; }
    // Find user index; if not found seed from serverUser
    function findUserIndex(loggedInfo) { if (!loggedInfo) return -1; const idx = users.findIndex(u => String(u.id) === String(loggedInfo.id)); if (idx !== -1) return idx; return users.findIndex(u => u.email === loggedInfo.email) !== -1 ? users.findIndex(u => u.email === loggedInfo.email) : users.findIndex(u => u.username === loggedInfo.username); }
    let userIndex = findUserIndex(loggedInUser);
    if (userIndex === -1 && window.serverAuth && window.serverUser) {
        const seed = { id: window.serverUser.id || Date.now(), username: window.serverUser.username || window.serverUser.email || 'user' + Date.now(), email: window.serverUser.email || '', password: '', phone: window.serverUser.phone || '', created_at: window.serverUser.loggedInAt || window.serverUser.created_at || new Date().toISOString() };
        users.push(seed); localStorage.setItem('users', JSON.stringify(users)); userIndex = findUserIndex(seed);
    }
    if (userIndex === -1) { alert('User record not found.'); window.location.href = 'login.html'; return; }
    // Build user payload & apply local changes
    const user = users[userIndex];
    if (newUsername && newUsername !== user.username) { const usernameExists = users.some(u => u.username === newUsername && u.id !== user.id); if (usernameExists) { alert('Username already exists.'); return; } user.username = newUsername; }
    if (newPassword) { if (newPassword.length < 6) { alert('New password must be at least 6 characters long.'); return; } user.password = newPassword; }
    if (newPhone) { const normalized = (function(p){let s=p.replace(/[^+0-9]/g,''); if(/^09\d{9}$/.test(s)) return '+63'+s.substring(1); if(/^9\d{9}$/.test(s)) return '+63'+s; if(/^[+]?63\d{9}$/.test(s)) return s.startsWith('+')?s:'+'+s; return null;})(newPhone); if (!normalized) { alert('Invalid phone'); return; } user.phone = normalized; }
    const updatedLoggedInUser = Object.assign({}, loggedInUser, { id: user.id, username: user.username, email: user.email, phone: user.phone || '', loggedInAt: loggedInUser.loggedInAt || loggedInUser.created_at });
    if (window.serverAuth && window.serverUser) {
        // Persist to server via JSON (no profile pic here)
        try {
            const res = await fetch('api/update-profile.php', { method: 'POST', credentials: 'include', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: user.username, current_password: currentPassword, new_password: newPassword || '', phone: user.phone || '' }) });
            const data = await res.json();
            if (!data || !data.success) { const msg = (data && data.errors && data.errors.length) ? data.errors.join(' | ') : 'Server update failed'; alert(msg); return; }
            const su = Object.assign({}, data.session_user); if (!su.loggedInAt && su.created_at) su.loggedInAt = su.created_at; try { localStorage.setItem('loggedInUser', JSON.stringify(su)); } catch(e) {}
            users[userIndex] = Object.assign(users[userIndex] || {}, { username: data.session_user.username, phone: data.session_user.phone }); localStorage.setItem('users', JSON.stringify(users));
            const picPath = data.session_user.profile_pic_path || data.session_user.profile_pic || '';
            const profileImgs = document.querySelectorAll('.profile-img'); if (picPath && profileImgs) { profileImgs.forEach(i => { i.src = picPath; i.alt = `${data.session_user.username}'s profile`; }); }
            document.getElementById('current-username').textContent = data.session_user.username; if (document.getElementById('current-phone')) document.getElementById('current-phone').textContent = data.session_user.phone || 'N/A';
            alert('Account settings updated successfully!'); resetForm();
            return;
        } catch (err) { console.error(err); alert('Server update failed'); return; }
    }
    // Local only update
    users[userIndex] = user; localStorage.setItem('users', JSON.stringify(users)); localStorage.setItem('loggedInUser', JSON.stringify(updatedLoggedInUser));
    document.getElementById('current-username').textContent = user.username; const profileImgs = document.querySelectorAll('.profile-img'); const picPath = user.profile_pic || user.profile_pic_path || ''; if (picPath && profileImgs) profileImgs.forEach(i => { i.src = picPath; i.alt = `${user.username}'s profile`; }); if (document.getElementById('current-phone')) document.getElementById('current-phone').textContent = user.phone || 'N/A'; alert('Account settings updated successfully!'); resetForm();
});

function resetForm() {
    const newPhoneEl = document.getElementById('new-phone');
    const preservePhone = newPhoneEl ? newPhoneEl.value : '';
    document.getElementById('account-form').reset();
    if (newPhoneEl && preservePhone) newPhoneEl.value = preservePhone;
}

function confirmDeleteAccount() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        if (confirm('This will permanently delete your account and all associated data. Are you absolutely sure?')) {
            let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || 'null');
            if (!loggedInUser && typeof window !== 'undefined' && typeof window.serverAuth !== 'undefined' && window.serverAuth === true && typeof window.serverUser !== 'undefined') {
                loggedInUser = window.serverUser;
            }
            if (!loggedInUser) {
                alert('Session expired.');
                return;
            }

            // Remove user from users array
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            function deleteFind(uinfo) {
                // delete by id, then email, then username
                if (uinfo.id) return u => String(u.id) === String(uinfo.id);
                if (uinfo.email) return u => u.email === uinfo.email;
                if (uinfo.username) return u => u.username === uinfo.username;
                return u => false;
            }
            const predicate = deleteFind(loggedInUser);
            const updatedUsers = users.filter(u => !predicate(u));
            localStorage.setItem('users', JSON.stringify(updatedUsers));

            // Clear logged in user data
            localStorage.removeItem('loggedInUser');

            alert('Account deleted successfully.');
            window.location.href = 'login.html';
        }
    }
}

    // Load saved username on page load
    document.addEventListener('DOMContentLoaded', async function() {
        // Fetch server session info (if any) and expose to client for pages that are static HTML
        if (!(typeof window !== 'undefined' && typeof window.serverAuth !== 'undefined' && window.serverAuth === true)) {
            try {
                const r = await fetch('debug/session.php', { credentials: 'include' });
                const data = await r.json();
                if (data && data.session_data && data.session_data.user_id) {
                    window.serverAuth = true;
                    // Normalize paths in returned server data so logos and avatars persist across refresh
                    let serverPic = data.session_data.profile_pic || data.session_data.profile_pic_path || '';
                    if (serverPic && serverPic.indexOf('http') !== 0 && !serverPic.startsWith('/')) serverPic = '/4D-Signs/' + serverPic;
                    window.serverUser = {
                        id: data.session_data.user_id,
                        username: data.session_data.username || data.session_data.email || '',
                        email: data.session_data.email || '',
                        phone: data.session_data.phone || '',
                        profile_pic: serverPic,
                        profile_pic_path: serverPic,
                        loggedInAt: data.session_data.loggedInAt || data.session_data.created_at || '',
                        is_admin: data.session_data.is_admin && (data.session_data.is_admin === '1' || data.session_data.is_admin === 1 || data.session_data.is_admin === true) ? true : false
                    };
                    try { localStorage.setItem('loggedInUser', JSON.stringify(window.serverUser)); } catch(e) {}
                }
            } catch (e) { /* ignore */ }
        }
        // Preview profile picture file selection and wire avatar upload (separate from the update form)
        // We'll create a hidden file input and bind avatar interactions to it
        let profilePicInput = document.getElementById('profile-pic');
        if (!profilePicInput) {
            profilePicInput = document.createElement('input');
            profilePicInput.type = 'file';
            profilePicInput.accept = 'image/*';
            profilePicInput.id = 'profile-pic';
            profilePicInput.className = 'profile-pic-input';
            document.body.appendChild(profilePicInput);
        }
        if (profilePicInput) {
            profilePicInput.addEventListener('change', function(e) {
                const f = e.target.files[0];
                if (!f) return;
                const url = URL.createObjectURL(f);
                // Update all header/profile images immediately with the selected file preview
                const imgs = document.querySelectorAll('.profile-img');
                if (imgs) imgs.forEach(i => { i.src = url; i.alt = 'Selected profile picture'; });
                const avatarImg = document.querySelector('.avatar-img');
                if (avatarImg) { avatarImg.src = url; avatarImg.alt = 'Selected profile picture'; }
                img.alt = 'Selected profile picture';
                // Immediately upload the selected picture (separate flow)
                uploadProfilePic(f);
                // clear input so future identical file selections still trigger change
                try { profilePicInput.value = ''; } catch (e) {}
            });
        }

        // Apply profile data to UI (avatar and header images)
        function applyProfileToUI(su) {
            if (!su) return;
            let picPath = su.profile_pic_path || su.profile_pic || '';
            if (picPath && picPath.indexOf('http') !== 0 && !picPath.startsWith('/')) {
                picPath = '/4D-Signs/' + picPath;
            }
            const imgs = document.querySelectorAll('.profile-img');
            if (picPath && imgs) imgs.forEach(i => { i.src = picPath; i.alt = `${su.username || ''}'s profile`; });
            // If avatar exists set that too
            const avatarImg = document.querySelector('.avatar-img');
            if (picPath && avatarImg) { avatarImg.src = picPath; avatarImg.alt = `${su.username || ''}'s profile`; }
        }

        // Upload profile picture as a separate endpoint call
        async function uploadProfilePic(file) {
            try {
                const fd = new FormData();
                fd.append('profilePic', file);
                // We don't send current password for profile pic updates; server trusts session auth
                const r = await fetch('api/update-profile.php', { method: 'POST', credentials: 'include', body: fd });
                const data = await r.json();
                if (!data || !data.success) {
                    const msg = (data && data.errors && data.errors.length) ? data.errors.join(' | ') : 'Failed to upload profile picture';
                    alert(msg);
                    return;
                }
                // Update session/local storage and UI with returned path
                const su = Object.assign({}, data.session_user);
                if (su.profile_pic_path && su.profile_pic_path.indexOf('http') !== 0 && !su.profile_pic_path.startsWith('/')) su.profile_pic_path = '/4D-Signs/' + su.profile_pic_path;
                if (su.profile_pic && su.profile_pic.indexOf('http') !== 0 && !su.profile_pic.startsWith('/')) su.profile_pic = '/4D-Signs/' + su.profile_pic;
                if (!su.loggedInAt && su.created_at) su.loggedInAt = su.created_at;
                try { localStorage.setItem('loggedInUser', JSON.stringify(su)); } catch(e) {}
                // Update header/profile images
                // Apply to both header and avatar (with cache-busting to ensure reload)
                applyProfileToUI(su);
                // Force reload of the image to avoid old cached version
                try {
                    const pics = document.querySelectorAll('.profile-img');
                    const avatarImg = document.querySelector('.avatar-img');
                    const ppath = su.profile_pic_path || su.profile_pic || '';
                    const url = ppath ? ppath + '?t=' + Date.now() : '';
                    if (url && pics) pics.forEach(i => i.src = url);
                    if (url && avatarImg) avatarImg.src = url;
                } catch(e) { /* ignore */ }
                alert('Profile picture updated!');
            } catch (err) {
                console.error('uploadProfilePic error', err);
                alert('Failed to upload profile picture.');
            }
        }
    let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || 'null');
    // Normalize paths in local storage user data for consistency and apply to UI
    if (loggedInUser) {
        if (loggedInUser.profile_pic_path && loggedInUser.profile_pic_path.indexOf('http') !== 0 && !loggedInUser.profile_pic_path.startsWith('/')) loggedInUser.profile_pic_path = '/4D-Signs/' + loggedInUser.profile_pic_path;
        if (loggedInUser.profile_pic && loggedInUser.profile_pic.indexOf('http') !== 0 && !loggedInUser.profile_pic.startsWith('/')) loggedInUser.profile_pic = '/4D-Signs/' + loggedInUser.profile_pic;
        localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
        applyProfileToUI(loggedInUser);
    }
    if (!loggedInUser && typeof window !== 'undefined' && typeof window.serverAuth !== 'undefined' && window.serverAuth === true && typeof window.serverUser !== 'undefined') {
        loggedInUser = window.serverUser;
    }

    if (!loggedInUser) {
        alert('Please login first to access account settings.');
    window.location.href = 'login.html';
        return;
    }

    // Update profile button image using server-supplied path if available, otherwise initials
    const profileImg = document.querySelector('.profile-img');
    if (profileImg) {
        const pic = loggedInUser.profile_pic || loggedInUser.profile_pic_path || loggedInUser.profilePic || '';
        if (pic) {
            profileImg.src = pic;
            profileImg.alt = `${loggedInUser.username}'s profile`;
        } else if (loggedInUser.username) {
            const initials = loggedInUser.username.charAt(0).toUpperCase();
            profileImg.src = `https://via.placeholder.com/32x32/FFD700/28263A?text=${initials}`;
            profileImg.alt = `${loggedInUser.username}'s profile`;
        }
    }

    // Avatar username has been removed from the UI

    // Wire avatar click to open upload dialog
    const avatarWrap = document.getElementById('avatar-wrap');
    const avatarEdit = document.getElementById('avatar-edit');
    if (avatarWrap) {
        avatarWrap.addEventListener('click', function() { profilePicInput.click(); });
    }
    if (avatarEdit) {
        avatarEdit.addEventListener('click', function(e) { e.stopPropagation(); profilePicInput.click(); });
    }

    // Display real user information
    document.getElementById('current-username').textContent = loggedInUser.username;
    document.getElementById('current-email').textContent = loggedInUser.email;
    const setPhone = (num) => { if (document.getElementById('current-phone')) document.getElementById('current-phone').textContent = num || 'N/A'; };

    // Ensure loggedInAt exists from created_at if needed (for older entries)
    if (loggedInUser && !loggedInUser.loggedInAt && loggedInUser.created_at) loggedInUser.loggedInAt = loggedInUser.created_at;
    // Attempt to load phone from loggedInUser or users array
    const phoneFromLogged = loggedInUser.phone || '';
    if (phoneFromLogged) {
        setPhone(phoneFromLogged);
        const el = document.getElementById('new-phone'); if (el && !el.value) el.value = phoneFromLogged;
    } else {
        // Try to find the user in the users list
        try {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const u = users.find(x => x.id === loggedInUser.id);
            if (u && u.phone) { setPhone(u.phone); const el = document.getElementById('new-phone'); if (el && !el.value) el.value = u.phone; }
            else setPhone('N/A');
        } catch(e) { setPhone('N/A'); }
    }

    // Format the member since date (if available)
    if (loggedInUser.loggedInAt) {
        // Normalize datetime string into ISO format accepted by Date
        const iso = String(loggedInUser.loggedInAt).replace(' ', 'T');
        const createdDate = new Date(iso);
        const memberSince = createdDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long'
        });
        document.getElementById('member-since').textContent = memberSince;
    } else {
        document.getElementById('member-since').textContent = 'Unknown';
    }

    document.getElementById('footer-year').textContent = new Date().getFullYear();
});
// Update profile images in other tabs if loggedInUser changes in localStorage
window.addEventListener('storage', function(e) {
    if (e.key === 'loggedInUser') {
        try {
            const su = JSON.parse(e.newValue || 'null');
            if (su) {
                if (su.profile_pic && su.profile_pic.indexOf('http') !== 0 && !su.profile_pic.startsWith('/')) su.profile_pic = '/4D-Signs/' + su.profile_pic;
                if (su.profile_pic_path && su.profile_pic_path.indexOf('http') !== 0 && !su.profile_pic_path.startsWith('/')) su.profile_pic_path = '/4D-Signs/' + su.profile_pic_path;
                applyProfileToUI(su);
            }
        } catch (err) { /* ignore */ }
    }
});
    </script>
</body>
</html>